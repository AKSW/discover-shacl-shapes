#!/usr/bin/env php
<?php

$rootDir = __DIR__ .'/../';

require $rootDir . 'app/config.php';
require $rootDir . 'vendor/autoload.php';

ini_set('default_charset', 'utf-8');

/*
 * download ZIP from Github repo
 */
$masterZip = 'https://github.com/AKSW/shacl-shapes/archive/master.zip';
$rulesZipPath = sys_get_temp_dir() . '/shacl-shapes.zip';
$rulesUnzippedPath = sys_get_temp_dir() . '/shacl-shapes/';
@unlink($rulesZipPath);
file_put_contents($rulesZipPath, fopen($masterZip, 'r'));

if (file_exists($rulesZipPath)) {
    echo PHP_EOL . 'File '. $masterZip .' downloaded to '. $rulesZipPath;
    echo PHP_EOL;

    /*
     * unzip downloaded ZIP file
     */
    unzipFile($rulesZipPath, $rulesUnzippedPath);

    /*
     * read all .ttl files into the store
     */
    $rulesFolder = $rulesUnzippedPath . 'shacl-shapes-master/shape-infos';

    /*
     * model data
     */
    $filesToImport = getFilesOfType($rulesFolder, '.ttl');
    importFiles($filesToImport, $config['db'], $config['graphs']['shapes']);
} else {
    echo PHP_EOL . 'Download of '. $rulesZipPath .' failed.';
}

echo PHP_EOL;
echo PHP_EOL;
